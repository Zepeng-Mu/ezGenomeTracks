---
title: "Advanced Usage of ezGenomeTracks"
author: "ezGenomeTracks Team"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Advanced Usage of ezGenomeTracks}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 8,
  fig.height = 8
)
```

## Introduction

This vignette demonstrates advanced usage of the `ezGenomeTracks` package for creating complex genomic visualizations. We'll cover importing data from files, customizing track appearance, and creating multi-panel visualizations.

```{r setup}
library(ezGenomeTracks)
```

## Importing Data from Files

The `ezGenomeTracks` package provides functions for importing genomic data from various file formats. Here, we'll demonstrate how to import data from the example files included with the package.

```{r}
# Get the path to the example files
signal_file <- system.file("extdata", "example_signal.bedgraph", package = "ezGenomeTracks")
peak_file <- system.file("extdata", "example_peaks.bed", package = "ezGenomeTracks")
gene_file <- system.file("extdata", "example_genes.gtf", package = "ezGenomeTracks")
interaction_file <- system.file("extdata", "example_interactions.bedpe", package = "ezGenomeTracks")
hic_file <- system.file("extdata", "example_hic.matrix", package = "ezGenomeTracks")
```

### Importing Signal Data

```{r}
# Define the region of interest
region <- "chr1:1000000-1100000"

# Import signal data
signal_data <- import_genomic_data(signal_file, format = "bedGraph", region = region)
head(signal_data)
```

### Importing Peak Data

```{r}
# Import peak data
peak_data <- import_genomic_data(peak_file, format = "bed", region = region)
head(peak_data)
```

### Importing Gene Data

```{r}
# Import gene data
gene_data <- import_genomic_data(gene_file, format = "gtf", region = region)
head(gene_data)
```

## Creating a Complex Visualization

Now, let's create a complex visualization with multiple tracks, custom styling, and annotations.

### Step 1: Create Individual Tracks

```{r}
# Create a signal track
signal_track <- ez_coverage(
  data = signal_data,
  fill = "steelblue",
  color = "navy",
  type = "area"
) +
  ggtitle("Signal Track") +
  ez_coverage_theme()

# Create a peak track
peak_track <- ez_peak(
  data = peak_data,
  fill = "coral",
  color = "red",
  use_score = TRUE
) +
  ggtitle("Peak Track") +
  ez_peak_theme()

# Create a gene track
gene_track <- ez_gene(
  data = gene_data,
  fill = "darkgreen",
  color = "black"
) +
  ggtitle("Gene Track") +
  ez_gene_theme()
```

### Step 2: Add Annotations

```{r}
# Add a vertical line to highlight a position of interest
signal_track <- add_vline(
  signal_track,
  position = 1050000,
  color = "red",
  linetype = "dashed"
)

# Add a rectangle to highlight a region of interest
peak_track <- add_rect(
  peak_track,
  xmin = 1020000,
  xmax = 1030000,
  fill = "yellow",
  alpha = 0.3
)

# Add text annotations
gene_track <- add_text(
  gene_track,
  x = 1050000,
  y = 0.5,
  label = "Gene of Interest",
  color = "darkgreen"
)
```

### Step 3: Stack the Tracks

```{r}
# Stack the tracks with custom heights
p <- genome_plot(
  signal_track,
  peak_track,
  gene_track,
  heights = c(2, 1, 1.5),
  region = region
)

# Display the stacked tracks
p
```

## Creating Multi-Panel Visualizations

You can create multi-panel visualizations by creating multiple stacked track plots and arranging them using packages like `patchwork` or `gridExtra`.

```{r, eval=FALSE}
# Create two different regions of interest
region1 <- "chr1:1000000-1050000"
region2 <- "chr1:1050000-1100000"

# Create stacked tracks for region 1
p1 <- genome_plot(
  ez_coverage(data = signal_data, fill = "steelblue", region = region1),
  ez_peak(data = peak_data, fill = "coral", region = region1),
  ez_gene(data = gene_data, fill = "darkgreen", region = region1),
  heights = c(2, 1, 1.5),
  region = region1
)

# Create stacked tracks for region 2
p2 <- genome_plot(
  ez_coverage(data = signal_data, fill = "steelblue", region = region2),
  ez_peak(data = peak_data, fill = "coral", region = region2),
  ez_gene(data = gene_data, fill = "darkgreen", region = region2),
  heights = c(2, 1, 1.5),
  region = region2
)

# Arrange the plots side by side using patchwork
library(patchwork)
p1 + p2 + plot_layout(ncol = 2)
```

## Customizing Track Appearance

The `ezGenomeTracks` package provides several options for customizing the appearance of tracks. Here are some examples:

### Customizing Signal Tracks

```{r}
# Create a signal track with different visualization types
signal_line <- ez_coverage(
  data = signal_data,
  type = "line",
  color = "blue",
  size = 1
) +
  ggtitle("Line Signal Track")

signal_area <- ez_coverage(
  data = signal_data,
  type = "area",
  fill = "lightblue",
  color = "blue",
  alpha = 0.7
) +
  ggtitle("Area Signal Track")

signal_heatmap <- ez_coverage(
  data = signal_data,
  type = "heatmap",
  low = "white",
  high = "blue"
) +
  ggtitle("Heatmap Signal Track")

# Stack the different signal tracks
p_signal <- genome_plot(
  signal_line,
  signal_area,
  signal_heatmap,
  heights = c(1, 1, 1),
  region = region
)

# Display the stacked signal tracks
p_signal
```

### Customizing Peak Tracks

```{r}
# Create a peak track with score-based coloring
peak_score <- ez_peak(
  data = peak_data,
  fill = "coral",
  color = "red",
  use_score = TRUE
) +
  ggtitle("Score-colored Peak Track")

# Create a peak track with fixed coloring
peak_fixed <- ez_peak(
  data = peak_data,
  fill = "purple",
  color = "darkpurple",
  use_score = FALSE
) +
  ggtitle("Fixed-color Peak Track")

# Stack the different peak tracks
p_peak <- genome_plot(
  peak_score,
  peak_fixed,
  heights = c(1, 1),
  region = region
)

# Display the stacked peak tracks
p_peak
```

## Conclusion

The `ezGenomeTracks` package provides a flexible and powerful framework for creating complex genomic visualizations. By combining different track types, customizing their appearance, and adding annotations, you can create informative and visually appealing genome browser-style visualizations.

For more information on the available functions and options, please refer to the package documentation and other vignettes.